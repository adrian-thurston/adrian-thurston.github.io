<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> rlgen-ruby / ruby 1.9 incompatibilities, possiblefixes, and offer 	to patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:ragel-users%40colm.net?Subject=Re%3A%20rlgen-ruby%20/%20ruby%201.9%20incompatibilities%2C%20possiblefixes%2C%20and%20offer%20%0A%09to%20patch&In-Reply-To=%3C6c8581dd-b7c7-4b97-b416-9d6486c1deb3%40p69g2000hsa.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002214.html">
   <LINK REL="Next"  HREF="002216.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>rlgen-ruby / ruby 1.9 incompatibilities, possiblefixes, and offer 	to patch</H1>
    <B>Ana Nelson</B> 
    <A HREF="mailto:ragel-users%40colm.net?Subject=Re%3A%20rlgen-ruby%20/%20ruby%201.9%20incompatibilities%2C%20possiblefixes%2C%20and%20offer%20%0A%09to%20patch&In-Reply-To=%3C6c8581dd-b7c7-4b97-b416-9d6486c1deb3%40p69g2000hsa.googlegroups.com%3E"
       TITLE="rlgen-ruby / ruby 1.9 incompatibilities, possiblefixes, and offer 	to patch">nelson.... at gmail.com
       </A><BR>
    <I>Thu Jan  3 21:01:40 UTC 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="002214.html">[ragel-users] Re: rlgen-ruby / ruby 1.9 incompatibilities, possiblefixes, and offer to patch
</A></li>
        <LI>Next message: <A HREF="002216.html">[ragel-users] Re: rlgen-ruby / ruby 1.9 incompatibilities, possiblefixes, and offer  to patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2215">[ date ]</a>
              <a href="thread.html#2215">[ thread ]</a>
              <a href="subject.html#2215">[ subject ]</a>
              <a href="author.html#2215">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have the Hello World example running in Ruby 1.9. I replaced &quot;:&quot;
with &quot;then&quot; in the generated code as per Dan's suggestion, and I added
the following line in the example's run_machine method which converts
&quot;data&quot; to an array of integers using String#unpack.

data = data.unpack(&quot;c*&quot;) if data.is_a?(String)

Nothing else needs to change and this is also Ruby 1.8 compatible.
(I'll update my example with this - thanks, Dan)

Code like this could be generated by write init. But that's only if
Ragel wants to accommodate lazy Ruby programmers who want to pass in
strings when the documentation calls for arrays, now that in Ruby 1.9
strings don't happen to behave like arrays of integers by default. ;-)

Another approach would be to .unpack(&quot;c&quot;) (.ord is Ruby 1.9 only) each
individual character when it is processed but that means testing each
individual item to see whether it's a string or an int, or defining
an .unpack method on Fixnum if we want to be clever. This seems more
invasive in terms of changing rlgen-ruby, but perhaps it would be
better from a memory management point of view. I'm guessing from what
little I know about it, though, that people who are concerned about
memory management won't be passing around giant strings, so probably
the simpler 1-line option is fine. (I'd be happy to be corrected/
educated on that.)

I'm biased towards thinking that Ragel shouldn't try to do too much to
accommodate this change in Ruby's treatment of strings, unless it's
because of a conscious decision to support string inputs.

Regards,
Ana


On Jan 3, 4:50 am, &quot;Bruce Williams&quot; &lt;<A HREF="http://www.colm.net/cgi-bin/mailman/listinfo/ragel-users">br... at codefluency.com</A>&gt; wrote:
&gt;<i> Adrian,
</I>&gt;<i>
</I>&gt;<i> In 1.9, use String#ord:
</I>&gt;<i>
</I>&gt;<i> ------------------------------------------------------------- String#ord
</I>&gt;<i>      str.ord   =&gt; integer
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i>      Return the +Integer+ ordinal of a one-character string.
</I>&gt;<i>
</I>&gt;<i>         &quot;a&quot;.ord         #=&gt; 97
</I>&gt;<i>
</I>&gt;<i> So, &quot;foo&quot;[1].ord in 1.9 should be equivalent to &quot;foo&quot;[1] in 1.8.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Bruce
</I>&gt;<i>
</I>&gt;<i> ---
</I>&gt;<i> Bruce <A HREF="Williamshttp://codefluency.com">Williamshttp://codefluency.com</A>
</I>&gt;<i>
</I>&gt;<i> On 1/2/08, Adrian Thurston &lt;<A HREF="http://www.colm.net/cgi-bin/mailman/listinfo/ragel-users">thurs... at cs.queensu.ca</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; I'll look this up tomorrow. Right now I'm in a train station. In the meantime are there any ruby experts out there that know the proper way to index arrays and strings and pull out numbers?
</I>&gt;<i>
</I>&gt;<i> &gt; Adrian
</I>&gt;<i> &gt; -----Original Message-----
</I>&gt;<i> &gt; From: dcgrigsby &lt;<A HREF="http://www.colm.net/cgi-bin/mailman/listinfo/ragel-users">dan-goo... at unpossible.com</A>&gt;
</I>&gt;<i>
</I>&gt;<i> &gt; Date: Wed, 2 Jan 2008 11:56:55
</I>&gt;<i> &gt; To:ragel-users &lt;<A HREF="http://www.colm.net/cgi-bin/mailman/listinfo/ragel-users">ragel-users at googlegroups.com</A>&gt;
</I>&gt;<i> &gt; Subject: [ragel-users] rlgen-ruby / ruby 1.9 incompatibilities, possible
</I>&gt;<i> &gt;  fixes, and offer to  patch
</I>&gt;<i>
</I>&gt;<i> &gt; Hello,
</I>&gt;<i>
</I>&gt;<i> &gt; The code generated by rlgen-ruby is incompatible with Ruby 1.9.
</I>&gt;<i>
</I>&gt;<i> &gt; Using the simple DevChix Hello World example (<A HREF="http://www.devchix.com/">http://www.devchix.com/</A>
</I>&gt;<i> &gt; 2007/12/13/a-hello-world-for-ruby-on-ragel/)., the generated &quot;write
</I>&gt;<i> &gt; exec&quot; ruby contains a handful of errors.
</I>&gt;<i>
</I>&gt;<i> &gt; 1) the &quot;when&quot; clause in the generated case statements uses a
</I>&gt;<i> &gt; deprecated form.  It is in the form &quot;when &lt;value&gt;:&quot; and should be
</I>&gt;<i> &gt; &quot;when &lt;value&gt; then&quot; instead.
</I>&gt;<i>
</I>&gt;<i> &gt; 2) under 1.9, a string element reference (i.e., [] operator) returns a
</I>&gt;<i> &gt; string, not a fixnum as under 1.8.  So the comparisons like this...
</I>&gt;<i>
</I>&gt;<i> &gt;   if data[p] &lt; _hello_trans_keys[_mid]
</I>&gt;<i>
</I>&gt;<i> &gt; ...result in &quot;`&lt;': comparison of String with 104 failed
</I>&gt;<i> &gt; (ArgumentError)&quot; under 1.9.
</I>&gt;<i>
</I>&gt;<i> &gt; I'd be happy to work up a patch, hopefully one that works under both
</I>&gt;<i> &gt; 1.8 and 1.9, but I need some guidance.
</I>&gt;<i>
</I>&gt;<i> &gt; The former should be easy.  I found all the instances that use the
</I>&gt;<i> &gt; colon in when and changed them successfully.
</I>&gt;<i>
</I>&gt;<i> &gt; The later is where I'm uncertain.  Appending &quot;.to_s&quot; to both sides of
</I>&gt;<i> &gt; the comparison (needs to be both sides to retain 1.8 compatibility)
</I>&gt;<i> &gt; everywhere seems wrong.  At this point I'm doing little more than
</I>&gt;<i> &gt; grepping the source; I don't really comprehend what's going on, so a
</I>&gt;<i> &gt; point in the right direction would be welcome.
</I>&gt;<i>
</I>&gt;<i> &gt; Thanks,
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002214.html">[ragel-users] Re: rlgen-ruby / ruby 1.9 incompatibilities, possiblefixes, and offer to patch
</A></li>
	<LI>Next message: <A HREF="002216.html">[ragel-users] Re: rlgen-ruby / ruby 1.9 incompatibilities, possiblefixes, and offer  to patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2215">[ date ]</a>
              <a href="thread.html#2215">[ thread ]</a>
              <a href="subject.html#2215">[ subject ]</a>
              <a href="author.html#2215">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.colm.net/cgi-bin/mailman/listinfo/ragel-users">More information about the ragel-users
mailing list</a><br>
</body></html>
