From 510a4a3f3884a0ec7f2178f872f649c4098807ba Mon Sep 17 00:00:00 2001
From: Rinat Ibragimov <ibragimovrinat@mail.ru>
Date: Sun, 20 Aug 2017 20:31:07 +0300
Subject: [PATCH] document fall-through cases in a generated code

GCC7's Wimplicit-fallthrough diagnostics is designed to catch unintentional
falling through the case statements. The compiler tries to read into
comments to determine whenever code was intentionally written that way.

diff --git a/ragel/cdipgoto.cpp b/ragel/cdipgoto.cpp
index 05c92994..50d7f09d 100644
--- a/ragel/cdipgoto.cpp
+++ b/ragel/cdipgoto.cpp
@@ -233,6 +233,7 @@ void IpGotoCodeGen::GOTO_HEADER( RedStateAp *state )
 	}
 
 	/* Give the state a switch case. */
+	out << "// fall through\n";
 	out << "case " << state->id << ":\n";
 
 	if ( state->fromStateAction != 0 ) {
diff --git a/ragel/cdsplit.cpp b/ragel/cdsplit.cpp
index f494b730..155c0eb9 100644
--- a/ragel/cdsplit.cpp
+++ b/ragel/cdsplit.cpp
@@ -88,6 +88,7 @@ void SplitCodeGen::GOTO_HEADER( RedStateAp *state, bool stateInPartition )
 	}
 
 	/* Give the state a switch case. */
+	out << "// fall through\n";
 	out << "case " << state->id << ":\n";
 
 	if ( state->fromStateAction != 0 ) {
-- 
2.14.1

