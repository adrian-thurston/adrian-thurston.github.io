<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;3.2//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;META&nbsp;NAME=&quot;Generator&quot;&nbsp;CONTENT=&quot;MS&nbsp;Exchange&nbsp;Server&nbsp;version&nbsp;6.5.7654.12&quot;&gt;<br>
&lt;TITLE&gt;RE:&nbsp;[ragel-users]&nbsp;Parsing&nbsp;a&nbsp;template&nbsp;language&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;!--&nbsp;Converted&nbsp;from&nbsp;text/plain&nbsp;format&nbsp;--&gt;<br>
&lt;BR&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Keep&nbsp;in&nbsp;mind&nbsp;you&nbsp;can&nbsp;always&nbsp;muck&nbsp;with&nbsp;the&nbsp;location&nbsp;of&nbsp;'p'&nbsp;in&nbsp;your&nbsp;input&nbsp;string.&nbsp;&nbsp;There&nbsp;are&nbsp;ragel&nbsp;psudo&nbsp;functions&nbsp;(&nbsp;fhold,&nbsp;fexec&nbsp;)&nbsp;that&nbsp;do&nbsp;this&nbsp;for&nbsp;you,&nbsp;or&nbsp;you&nbsp;can&nbsp;always&nbsp;just&nbsp;do:&lt;BR&gt;<br>
&lt;BR&gt;<br>
&nbsp;&nbsp;p&nbsp;=&nbsp;p&nbsp;-&nbsp;2&lt;BR&gt;<br>
&lt;BR&gt;<br>
in&nbsp;your&nbsp;action&nbsp;code.&nbsp;&nbsp;The&nbsp;above&nbsp;is&nbsp;in&nbsp;C,&nbsp;actually,&nbsp;i'm&nbsp;not&nbsp;sure&nbsp;how&nbsp;to&nbsp;do&nbsp;that&nbsp;with&nbsp;ruby.&nbsp;&nbsp;Decrementing&nbsp;'p'&nbsp;in&nbsp;ruby&nbsp;probably&nbsp;won't&nbsp;back&nbsp;it&nbsp;up&nbsp;along&nbsp;the&nbsp;string,&nbsp;but&nbsp;maybe&nbsp;'fhold'&nbsp;or&nbsp;'fexec'&nbsp;can&nbsp;help&nbsp;you.&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;have&nbsp;used&nbsp;the&nbsp;(&nbsp;any*&nbsp;--&nbsp;token&nbsp;)&nbsp;trick&nbsp;to&nbsp;advance&nbsp;to&nbsp;the&nbsp;token,&nbsp;and&nbsp;then&nbsp;modify&nbsp;'p'&nbsp;to&nbsp;get&nbsp;it&nbsp;back&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;token.&lt;BR&gt;<br>
&lt;BR&gt;<br>
Perhaps&nbsp;other&nbsp;in&nbsp;this&nbsp;list&nbsp;know&nbsp;a&nbsp;cleaner&nbsp;way&nbsp;to&nbsp;do&nbsp;this,&nbsp;but&nbsp;its&nbsp;what&nbsp;I've&nbsp;found&nbsp;that&nbsp;works.&lt;BR&gt;<br>
&lt;BR&gt;<br>
-----Original&nbsp;Message-----&lt;BR&gt;<br>
From:&nbsp;ragel-users-bounces@complang.org&nbsp;on&nbsp;behalf&nbsp;of&nbsp;Tobias&nbsp;Lütke&lt;BR&gt;<br>
Sent:&nbsp;Thu&nbsp;7/29/2010&nbsp;12:40&nbsp;AM&lt;BR&gt;<br>
To:&nbsp;ragel-users@complang.org&lt;BR&gt;<br>
Subject:&nbsp;Re:&nbsp;[ragel-users]&nbsp;Parsing&nbsp;a&nbsp;template&nbsp;language&lt;BR&gt;<br>
&lt;BR&gt;<br>
Thanks&nbsp;Alex,&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;modified&nbsp;the&nbsp;code&nbsp;to&nbsp;your&nbsp;clever&nbsp;example.&nbsp;This&nbsp;almost&nbsp;works,&nbsp;however&lt;BR&gt;<br>
after&nbsp;running&nbsp;the&nbsp;any*&nbsp;scanner&nbsp;p&nbsp;will&nbsp;be&nbsp;advanced&nbsp;all&nbsp;the&nbsp;way&nbsp;to&nbsp;the&lt;BR&gt;<br>
end&nbsp;of&nbsp;{{,&nbsp;so&nbsp;the&nbsp;other&nbsp;rule&nbsp;will&nbsp;not&nbsp;match&nbsp;the&nbsp;tag&nbsp;correctly.&nbsp;Here&nbsp;is&lt;BR&gt;<br>
my&nbsp;current&nbsp;machine:&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;machine&nbsp;parser;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;action&nbsp;start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;tokstart&nbsp;=&nbsp;p;&nbsp;}&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;action&nbsp;on_tag&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;results&nbsp;&lt;&lt;&nbsp;[:tag,&nbsp;&nbsp;&nbsp;&nbsp;data[tokstart..p]]&nbsp;}&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;action&nbsp;on_static&nbsp;&nbsp;{&nbsp;results&nbsp;&lt;&lt;&nbsp;[:static,&nbsp;data[tokstart..p]]&nbsp;}&lt;BR&gt;<br>
&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tag&nbsp;&nbsp;=&nbsp;'{{'&nbsp;lower+&nbsp;'}}'&nbsp;&gt;start&nbsp;@on_tag;&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;html&nbsp;=&nbsp;(any*&nbsp;--&nbsp;'{{')&nbsp;&nbsp;&nbsp;&gt;start&nbsp;@on_static;&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EOF&nbsp;=&nbsp;0;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;main&nbsp;:=&nbsp;|*&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tag;&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;html;&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EOF;&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*|;&lt;BR&gt;<br>
&lt;BR&gt;<br>
Regards&lt;BR&gt;<br>
--&nbsp;tobi&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
On&nbsp;Tue,&nbsp;Jul&nbsp;27,&nbsp;2010&nbsp;at&nbsp;9:52&nbsp;PM,&nbsp;Laslavic,&nbsp;Alex&lt;BR&gt;<br>
&lt;Alex.Laslavic@turner.com&gt;&nbsp;wrote:&lt;BR&gt;<br>
&gt;&nbsp;I'm&nbsp;actually&nbsp;working&nbsp;on&nbsp;a&nbsp;similar&nbsp;sounding&nbsp;task.&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&nbsp;Try&nbsp;the&nbsp;strong&nbsp;subtraction&nbsp;operator&lt;BR&gt;<br>
&gt;&nbsp;Untested:&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&nbsp;main&nbsp;:=&nbsp;|*&lt;BR&gt;<br>
&gt;&nbsp; &nbsp;'[['&nbsp;lower+&nbsp;']]'&nbsp;=&gt;&nbsp;action&lt;BR&gt;<br>
&gt;&nbsp; &nbsp;(&nbsp;any*&nbsp;--&nbsp;'[['&nbsp;)&nbsp;=&gt;&nbsp;action&lt;BR&gt;<br>
&gt;&nbsp;*|;&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&nbsp;(&nbsp;any*&nbsp;--&nbsp;'[['&nbsp;)&nbsp;will&nbsp;match&nbsp;the&nbsp;longest&nbsp;possible&nbsp;string&nbsp;that&nbsp;doesn't&nbsp;have&lt;BR&gt;<br>
&gt;&nbsp;'[['&nbsp;as&nbsp;a&nbsp;substring.&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&nbsp;-----Original&nbsp;Message-----&lt;BR&gt;<br>
&gt;&nbsp;From:&nbsp;ragel-users-bounces@complang.org&nbsp;on&nbsp;behalf&nbsp;of&nbsp;Tobias&nbsp;Lütke&lt;BR&gt;<br>
&gt;&nbsp;Sent:&nbsp;Tue&nbsp;7/27/2010&nbsp;6:54&nbsp;PM&lt;BR&gt;<br>
&gt;&nbsp;To:&nbsp;ragel-users@complang.org&lt;BR&gt;<br>
&gt;&nbsp;Subject:&nbsp;Re:&nbsp;[ragel-users]&nbsp;Parsing&nbsp;a&nbsp;template&nbsp;language&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&nbsp;Depends&nbsp;on&nbsp;the&nbsp;answers&nbsp;in&nbsp;this&nbsp;thread&nbsp;I&nbsp;suppose&nbsp;:-)&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&nbsp;On&nbsp;Tue,&nbsp;Jul&nbsp;27,&nbsp;2010&nbsp;at&nbsp;3:42&nbsp;AM,&nbsp;Magnus&nbsp;Holm&nbsp;&lt;judofyr@gmail.com&gt;&nbsp;wrote:&lt;BR&gt;<br>
&gt;&gt;&nbsp;(A&nbsp;little&nbsp;off-topic,&nbsp;but&nbsp;whatever:&lt;BR&gt;<br>
&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&nbsp;So&nbsp;Liquid&nbsp;will&nbsp;finally&nbsp;get&nbsp;a&nbsp;proper&nbsp;parser?&nbsp;:-))&lt;BR&gt;<br>
&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&nbsp;//&nbsp;Magnus&nbsp;Holm&lt;BR&gt;<br>
&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&nbsp;On&nbsp;Tue,&nbsp;Jul&nbsp;27,&nbsp;2010&nbsp;at&nbsp;03:15,&nbsp;Tobias&nbsp;Lütke&nbsp;&lt;tobi@leetsoft.com&gt;&nbsp;wrote:&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;I've&nbsp;been&nbsp;working&nbsp;on&nbsp;a&nbsp;parser&nbsp;for&nbsp;simple&nbsp;template&nbsp;language.&nbsp;I'm&nbsp;using&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;Ragel.&lt;BR&gt;<br>
&gt;&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;The&nbsp;requirements&nbsp;are&nbsp;modest.&nbsp;I'm&nbsp;trying&nbsp;to&nbsp;find&nbsp;[[tags]]&nbsp;that&nbsp;can&nbsp;be&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;embedded&nbsp;anywhere&nbsp;in&nbsp;the&nbsp;input&nbsp;string.&lt;BR&gt;<br>
&gt;&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;I'm&nbsp;trying&nbsp;to&nbsp;parse&nbsp;a&nbsp;simple&nbsp;template&nbsp;language,&nbsp;something&nbsp;that&nbsp;can&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;have&nbsp;tags&nbsp;such&nbsp;as&nbsp;{{foo}}&nbsp;embedded&nbsp;within&nbsp;HTML.&nbsp;I&nbsp;tried&nbsp;several&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;approaches&nbsp;to&nbsp;parse&nbsp;this&nbsp;but&nbsp;had&nbsp;to&nbsp;resort&nbsp;to&nbsp;using&nbsp;a&nbsp;Ragel&nbsp;scanner&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;and&nbsp;use&nbsp;the&nbsp;inefficient&nbsp;approach&nbsp;of&nbsp;only&nbsp;matching&nbsp;a&nbsp;single&nbsp;character&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;as&nbsp;a&nbsp;&quot;catch&nbsp;all&quot;.&nbsp;I&nbsp;feel&nbsp;this&nbsp;is&nbsp;the&nbsp;wrong&nbsp;way&nbsp;to&nbsp;go&nbsp;about&nbsp;this.&nbsp;I'm&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;essentially&nbsp;abusing&nbsp;the&nbsp;longest-match&nbsp;bias&nbsp;of&nbsp;the&nbsp;scanner&nbsp;to&nbsp;implement&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;my&nbsp;default&nbsp;rule&nbsp;(&nbsp;it&nbsp;can&nbsp;only&nbsp;be&nbsp;1&nbsp;char&nbsp;long,&nbsp;so&nbsp;it&nbsp;should&nbsp;always&nbsp;be&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;the&nbsp;last&nbsp;resort&nbsp;).&lt;BR&gt;<br>
&gt;&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;%%{&lt;BR&gt;<br>
&gt;&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp; machine&nbsp;parser;&lt;BR&gt;<br>
&gt;&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp; action&nbsp;start&nbsp; &nbsp; &nbsp; {&nbsp;tokstart&nbsp;=&nbsp;p;&nbsp;}&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp; action&nbsp;on_tag&nbsp; &nbsp; &nbsp; {&nbsp;results&nbsp;&lt;&lt;&nbsp;[:tag,&nbsp;data[tokstart..p]]&nbsp;}&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp; action&nbsp;on_static&nbsp; {&nbsp;results&nbsp;&lt;&lt;&nbsp;[:static,&nbsp;data[p..p]]&nbsp;}&lt;BR&gt;<br>
&gt;&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp; tag&nbsp; =&nbsp;('[['&nbsp;lower+&nbsp;']]')&nbsp;&gt;start&nbsp;@on_tag;&lt;BR&gt;<br>
&gt;&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp; main&nbsp;:=&nbsp;|*&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp; &nbsp; tag;&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp; &nbsp; any&nbsp; &nbsp; &nbsp; =&gt;&nbsp;on_static;&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp; *|;&lt;BR&gt;<br>
&gt;&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;}%%&lt;BR&gt;<br>
&gt;&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;(&nbsp;actions&nbsp;written&nbsp;in&nbsp;ruby,&nbsp;but&nbsp;should&nbsp;be&nbsp;easy&nbsp;to&nbsp;understand&nbsp;).&lt;BR&gt;<br>
&gt;&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;How&nbsp;would&nbsp;you&nbsp;go&nbsp;about&nbsp;writing&nbsp;a&nbsp;parser&nbsp;for&nbsp;such&nbsp;a&nbsp;simple&nbsp;language?&nbsp;Is&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;Ragel&nbsp;maybe&nbsp;not&nbsp;the&nbsp;right&nbsp;tool?&nbsp;It&nbsp;seems&nbsp;you&nbsp;have&nbsp;to&nbsp;fight&nbsp;Ragel&nbsp;tooth&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;and&nbsp;nails&nbsp;if&nbsp;the&nbsp;syntax&nbsp;is&nbsp;unpredictable&nbsp;such&nbsp;as&nbsp;this.&lt;BR&gt;<br>
&gt;&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;Regards&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;--&nbsp;tobi&lt;BR&gt;<br>
&gt;&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;_______________________________________________&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;ragel-users&nbsp;mailing&nbsp;list&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;ragel-users@complang.org&lt;BR&gt;<br>
&gt;&gt;&gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://www.complang.org/mailman/listinfo/ragel-users&quot;&gt;http://www.complang.org/mailman/listinfo/ragel-users&lt;/A&gt;&lt;BR&gt;<br>
&gt;&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&lt;BR&gt;<br>
&gt;&gt;&nbsp;_______________________________________________&lt;BR&gt;<br>
&gt;&gt;&nbsp;ragel-users&nbsp;mailing&nbsp;list&lt;BR&gt;<br>
&gt;&gt;&nbsp;ragel-users@complang.org&lt;BR&gt;<br>
&gt;&gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://www.complang.org/mailman/listinfo/ragel-users&quot;&gt;http://www.complang.org/mailman/listinfo/ragel-users&lt;/A&gt;&lt;BR&gt;<br>
&gt;&gt;&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&nbsp;_______________________________________________&lt;BR&gt;<br>
&gt;&nbsp;ragel-users&nbsp;mailing&nbsp;list&lt;BR&gt;<br>
&gt;&nbsp;ragel-users@complang.org&lt;BR&gt;<br>
&gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://www.complang.org/mailman/listinfo/ragel-users&quot;&gt;http://www.complang.org/mailman/listinfo/ragel-users&lt;/A&gt;&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&nbsp;_______________________________________________&lt;BR&gt;<br>
&gt;&nbsp;ragel-users&nbsp;mailing&nbsp;list&lt;BR&gt;<br>
&gt;&nbsp;ragel-users@complang.org&lt;BR&gt;<br>
&gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://www.complang.org/mailman/listinfo/ragel-users&quot;&gt;http://www.complang.org/mailman/listinfo/ragel-users&lt;/A&gt;&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
_______________________________________________&lt;BR&gt;<br>
ragel-users&nbsp;mailing&nbsp;list&lt;BR&gt;<br>
ragel-users@complang.org&lt;BR&gt;<br>
&lt;A&nbsp;HREF=&quot;http://www.complang.org/mailman/listinfo/ragel-users&quot;&gt;http://www.complang.org/mailman/listinfo/ragel-users&lt;/A&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;
</tt>
