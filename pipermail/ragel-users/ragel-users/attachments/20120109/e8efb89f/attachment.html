<tt>
I&nbsp;have&nbsp;posted&nbsp;a&nbsp;question&nbsp;in&nbsp;&lt;a&nbsp;href=&quot;http://stackoverflow.com/questions/8784903/failed-to-convert-url-parser-regular-expression-to-ragel&quot;&gt;StackOverflow&lt;/a&gt;&nbsp;about&nbsp;it. &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;I&nbsp;found&nbsp;an&nbsp;URL&nbsp;parser&nbsp;regular&nbsp;expression&nbsp;at&nbsp;RFC&nbsp;2396&nbsp;and&nbsp;RFC&nbsp;3986.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;converted&nbsp;it&nbsp;to&nbsp;Ragel:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;%%{&nbsp; &nbsp; &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;#&nbsp;RFC&nbsp;3986&nbsp;URI&nbsp;Generic&nbsp;Syntax&nbsp;(January&nbsp;2005)&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp;machine&nbsp;url_parser;&lt;/div&gt;&lt;div&gt; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;action&nbsp;pchar&nbsp; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;printf(&quot;%c&quot;,&nbsp;fc);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;action&nbsp;scheme&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp;printf(&quot;scheme\n&quot;);&nbsp;}&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp;action&nbsp;scheme_end&nbsp; &nbsp; &nbsp;{&nbsp;printf(&quot;\nscheme_end\n&quot;);&nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;action&nbsp;authority&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&nbsp;printf(&quot;authority\n&quot;);&nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;action&nbsp;authority_end&nbsp; &nbsp; {&nbsp;printf(&quot;\nauthority_end\n&quot;);&nbsp;}&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp;action&nbsp;path&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp;printf(&quot;path\n&quot;);&nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;action&nbsp;path_end&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&nbsp;printf(&quot;\npath_end\n&quot;);&nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;action&nbsp;query&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp;printf(&quot;query\n&quot;);&nbsp;}&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp;action&nbsp;query_end&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&nbsp;printf(&quot;\nquery_end\n&quot;);&nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;action&nbsp;fragment&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&nbsp;printf(&quot;fragment\n&quot;);&nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;action&nbsp;fragment_end&nbsp; &nbsp; {&nbsp;printf(&quot;\nfragment_end\n&quot;);&nbsp;}&lt;/div&gt;<br>
&lt;div&gt; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;scheme&nbsp; &nbsp; =&nbsp;(any&nbsp;-&nbsp;[:/?#])+&nbsp;&gt;scheme&nbsp; &nbsp; $pchar&nbsp;%scheme_end&nbsp;;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;authority&nbsp;=&nbsp;(any&nbsp;-&nbsp;[/?#])*&nbsp; &gt;authority&nbsp;$pchar&nbsp;%authority_end&nbsp;;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;path&nbsp; &nbsp; &nbsp; =&nbsp;(any&nbsp;-&nbsp;[?#])*&nbsp; &nbsp;&gt;path&nbsp; &nbsp; &nbsp; $pchar&nbsp;%path_end&nbsp;;&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp;query&nbsp; &nbsp; &nbsp;=&nbsp;(any&nbsp;-&nbsp;[#])*&nbsp; &nbsp; &gt;query&nbsp; &nbsp; &nbsp;$pchar&nbsp;%query_end&nbsp;;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;fragment&nbsp; =&nbsp;(any)*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt;fragment&nbsp; $pchar&nbsp;%fragment_end&nbsp;; &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;main&nbsp; &nbsp; &nbsp;:=&nbsp;((&nbsp;scheme&nbsp;&quot;:&quot;&nbsp;)?)&nbsp;&lt;:&nbsp;((&nbsp;&quot;//&quot;&nbsp;authority&nbsp;)?)&nbsp;&lt;:&nbsp;path&nbsp;(&nbsp;&quot;?&quot;&nbsp;query&nbsp;)?&nbsp;(&nbsp;&quot;#&quot;&nbsp;fragment&nbsp;)?;&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;}%%&lt;/div&gt;&lt;div&gt; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;#include&nbsp;&lt;cstdio&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;#include&nbsp;&lt;cstdlib&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;#include&nbsp;&lt;string&gt;&lt;/div&gt;&lt;div&gt; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;/**&nbsp;Data&nbsp;**/&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;%%&nbsp;write&nbsp;data;&lt;/div&gt;&lt;div&gt;<br>
 &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;int&nbsp;main(int&nbsp;argc,&nbsp;char&nbsp;**argv)&nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;std::string&nbsp;str(argv[1]);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;char&nbsp;const*&nbsp;p&nbsp;=&nbsp;str.c_str();&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;char&nbsp;const*&nbsp;pe&nbsp;=&nbsp;p&nbsp;+&nbsp;str.size();&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;char&nbsp;const*&nbsp;eof&nbsp;=&nbsp;pe;&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp;int&nbsp;cs&nbsp;=&nbsp;0;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;%%&nbsp;write&nbsp;init;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;%%&nbsp;write&nbsp;exec;&lt;/div&gt;&lt;div&gt; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;return&nbsp;p&nbsp;-&nbsp;str.c_str();&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&#39;s&nbsp;work&nbsp;when&nbsp;I&nbsp;input&nbsp;absolute&nbsp;URI.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;liangxu@dev64:~$&nbsp;./uri_test&nbsp;&quot;&lt;a&nbsp;href=&quot;http://www.ics.uci.edu/pub/ietf/uri/?c=www&amp;rot=1&amp;e=%20%20&quot;&gt;http://www.ics.uci.edu/pub/ietf/uri/?c=www&amp;rot=1&amp;e=%20%20&lt;/a&gt;&quot;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;scheme&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;http&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;scheme_end&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;authority&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://www.ics.uci.edu&quot;&gt;www.ics.uci.edu&lt;/a&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;authority_end&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;path&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;/pub/ietf/uri/&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;path_end&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;query&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;c=www&amp;rot=1&amp;e=%20%20&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;query_end&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And&nbsp;success&nbsp;when&nbsp;I&nbsp;input&nbsp;authority&nbsp;and&nbsp;path:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;liangxu@dev64:~$&nbsp;./uri_test&nbsp;&quot;//&lt;a&nbsp;href=&quot;http://www.ics.uci.edu/pub/ietf/uri/?c=www&amp;rot=1&amp;e=%20%20&quot;&gt;www.ics.uci.edu/pub/ietf/uri/?c=www&amp;rot=1&amp;e=%20%20&lt;/a&gt;&quot;&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;authority&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://www.ics.uci.edu&quot;&gt;www.ics.uci.edu&lt;/a&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;authority_end&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;path&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;/pub/ietf/uri/&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;path_end&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;query&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;c=www&amp;rot=1&amp;e=%20%20&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;query_end&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;failed&nbsp;when&nbsp;I&nbsp;input&nbsp;only&nbsp;path:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;liangxu@dev64:~$&nbsp;./uri_test&nbsp;&quot;/pub/ietf/uri&quot;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&#39;s&nbsp;wrong?&lt;/div&gt;&lt;br&gt;--&nbsp;&lt;br&gt;<br>
Liang&nbsp;Xu&lt;br&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
