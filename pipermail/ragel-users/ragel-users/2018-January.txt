From space.ship.traveller at gmail.com  Fri Jan 26 08:59:00 2018
From: space.ship.traveller at gmail.com (Samuel Williams)
Date: Fri, 26 Jan 2018 21:59:00 +1300
Subject: [ragel] Ragel sanitise output - memory leaks
In-Reply-To: <2fe6a459b757842d0301a780398b9725@mail.colm.net>
References: <CAHkN8V8x5W9Fz=Wi+DZvP7=jGQL22OoRhGbcsob3CGokGnyteQ@mail.gmail.com>
 <CAHkN8V8cE9=uL+fOd150KQNXkmK9agoRey1Fi0K_3jLD0nrdrA@mail.gmail.com>
 <2fe6a459b757842d0301a780398b9725@mail.colm.net>
Message-ID: <CAHkN8V-jNgVeu3dhne0DTkXoiO3tixFcWw1Jk+LQFYG-x9hc2g@mail.gmail.com>

When sanitisers are on, the exit status is non-zero because of the memory
leaks, so it's not just clean build reports, but actually failed builds.

Thanks
Samuel

On 14 December 2017 at 05:22, Adrian Thurston <thurston at colm.net> wrote:

> Sorry, no change. The problems are in the form of memory leaks in ragel
> mucking up your clean build reports? Maybe you could turn them off for
> ragel? Honestly it's never really been a strong concern for me since ragel
> is a one-shot kind of program. Some improvements were made when I added
> libfsm, but that was mostly in the core FSM code.
>
> My current concerns with ragel are to get out-of-tree support for
> alternate host languages. Will have some time for that in December.
> Removing leaks is something I would work on when 7.0 gets to stable status.
>
> Adrian
>
> On 2017-11-08 20:08, Samuel Williams wrote:
>
> Any update to this? Still causing problems for me.
>
> On 9 October 2017 at 10:34, Samuel Williams <space.ship.traveller at gmail.
> com> wrote:
>
>> Here is some log output from a build which invokes ragel to generate
>> several parsers. I've cut out (most) unimportant output.
>>
>> The source code for the parsers: https://github.com/
>> kurocha/async-http/tree/master/source/Async/HTTP/V1
>>
>> The results from running Ragel several times with LLVM sanitisers:
>> https://gist.github.com/ioquatix/2e50ffb09697107338f8f75083400143
>>
>> The main issue I can see are memory leaks, but there could be other
>> issues.
>>
>> Since Ragel is a one-shot "compiler", perhaps it's not important to
>> address these, except as a matter of correctness.
>>
>> I think there are potential problem with memory leaks and they might be
>> covering up bigger issues - there might be cases where memory is being
>> accessed incorrectly but it's not causing a crash because it's not freed at
>> the right point etc.
>>
>> I'd suggest that if there is a test suite for Ragel, it's updated to run
>> with the undefined behaviour sanitiser and address sanitiser - both provide
>> useful output IMHO.
>>
>> Happy to provide more feedback.
>>
>> Kind regards,
>> Samuel
>>
>>
>
> _______________________________________________
> ragel mailing listragel at colm.nethttp://www.colm.net/cgi-bin/mailman/listinfo/ragel
>
>
> _______________________________________________
> ragel mailing list
> ragel at colm.net
> http://www.colm.net/cgi-bin/mailman/listinfo/ragel
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.colm.net/pipermail/ragel/attachments/20180126/cc46aa90/attachment.html>

From ferfebles at gmail.com  Sat Jan 27 09:41:42 2018
From: ferfebles at gmail.com (fer febles)
Date: Sat, 27 Jan 2018 09:41:42 +0000
Subject: [ragel] Using Ragel in the firmware of a keyboard
Message-ID: <CAKg5eAdPd6VDTK-DFWOsnBFmFv0RQ=bpvgLCqceSEzZeApTG-Q@mail.gmail.com>

Hi Adrian,

I'm using a small state machine to implement the logic for changing layers
in a small DIY keyboard called the Atreus:
https://github.com/ferfebles/atreus-2leds1speaker-ragel

It's being a fun and rewarding project. I just wanted to thank you for the
Ragel compiler and show you an apparently simple problem that was almost
impossible to be done right by hand.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.colm.net/pipermail/ragel/attachments/20180127/719d66d4/attachment.html>

From thurston at colm.net  Sat Jan 27 16:22:55 2018
From: thurston at colm.net (Adrian Thurston)
Date: Sat, 27 Jan 2018 11:22:55 -0500
Subject: [ragel] Using Ragel in the firmware of a keyboard
In-Reply-To: <CAKg5eAdPd6VDTK-DFWOsnBFmFv0RQ=bpvgLCqceSEzZeApTG-Q@mail.gmail.com>
References: <CAKg5eAdPd6VDTK-DFWOsnBFmFv0RQ=bpvgLCqceSEzZeApTG-Q@mail.gmail.com>
Message-ID: <000e02de3029daf52ec49cffc21a4513@mail.colm.net>

 

Thanks for the note, I appreciate the feedback. 

On 2018-01-27 04:41, fer febles wrote: 

> Hi Adrian, 
> 
> I'm using a small state machine to implement the logic for changing layers in a small DIY keyboard called the Atreus: https://github.com/ferfebles/atreus-2leds1speaker-ragel [2] 
> 
> It's being a fun and rewarding project. I just wanted to thank you for the Ragel compiler and show you an apparently simple problem that was almost impossible to be done right by hand. 
> 
> _______________________________________________
> ragel mailing list
> ragel at colm.net
> http://www.colm.net/cgi-bin/mailman/listinfo/ragel [1]
 

Links:
------
[1] http://www.colm.net/cgi-bin/mailman/listinfo/ragel
[2] https://github.com/ferfebles/atreus-2leds1speaker-ragel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.colm.net/pipermail/ragel/attachments/20180127/389c4c65/attachment.html>

From thurston at colm.net  Sat Jan 27 16:24:07 2018
From: thurston at colm.net (Adrian Thurston)
Date: Sat, 27 Jan 2018 11:24:07 -0500
Subject: [ragel] Ragel sanitise output - memory leaks
In-Reply-To: <CAHkN8V-jNgVeu3dhne0DTkXoiO3tixFcWw1Jk+LQFYG-x9hc2g@mail.gmail.com>
References: <CAHkN8V8x5W9Fz=Wi+DZvP7=jGQL22OoRhGbcsob3CGokGnyteQ@mail.gmail.com>
 <CAHkN8V8cE9=uL+fOd150KQNXkmK9agoRey1Fi0K_3jLD0nrdrA@mail.gmail.com>
 <2fe6a459b757842d0301a780398b9725@mail.colm.net>
 <CAHkN8V-jNgVeu3dhne0DTkXoiO3tixFcWw1Jk+LQFYG-x9hc2g@mail.gmail.com>
Message-ID: <0bd71775508a595c634b4ebf059588bf@mail.colm.net>

 

Why so strict on building? Does it really matter if a tool used in the a
build doesn't free everything before exiting? 

On 2018-01-26 03:59, Samuel Williams wrote: 

> When sanitisers are on, the exit status is non-zero because of the memory leaks, so it's not just clean build reports, but actually failed builds. 
> 
> Thanks 
> Samuel
> 
> On 14 December 2017 at 05:22, Adrian Thurston <thurston at colm.net> wrote:
> 
> Sorry, no change. The problems are in the form of memory leaks in ragel mucking up your clean build reports? Maybe you could turn them off for ragel? Honestly it's never really been a strong concern for me since ragel is a one-shot kind of program. Some improvements were made when I added libfsm, but that was mostly in the core FSM code. 
> 
> My current concerns with ragel are to get out-of-tree support for alternate host languages. Will have some time for that in December. Removing leaks is something I would work on when 7.0 gets to stable status. 
> 
> Adrian 
> 
> On 2017-11-08 20:08, Samuel Williams wrote: 
> 
> Any update to this? Still causing problems for me. 
> 
> On 9 October 2017 at 10:34, Samuel Williams <space.ship.traveller at gmail.com> wrote:
> 
> Here is some log output from a build which invokes ragel to generate several parsers. I've cut out (most) unimportant output. 
> 
> The source code for the parsers: https://github.com/kurocha/async-http/tree/master/source/Async/HTTP/V1 [2] 
> The results from running Ragel several times with LLVM sanitisers: https://gist.github.com/ioquatix/2e50ffb09697107338f8f75083400143 [3]
> 
> The main issue I can see are memory leaks, but there could be other issues. 
> 
> Since Ragel is a one-shot "compiler", perhaps it's not important to address these, except as a matter of correctness. 
> 
> I think there are potential problem with memory leaks and they might be covering up bigger issues - there might be cases where memory is being accessed incorrectly but it's not causing a crash because it's not freed at the right point etc. 
> 
> I'd suggest that if there is a test suite for Ragel, it's updated to run with the undefined behaviour sanitiser and address sanitiser - both provide useful output IMHO. 
> 
> Happy to provide more feedback. 
> 
> Kind regards, 
> Samuel 
> 
> _______________________________________________
> ragel mailing list
> ragel at colm.net
> http://www.colm.net/cgi-bin/mailman/listinfo/ragel [1]

_______________________________________________
 ragel mailing list
 ragel at colm.net
 http://www.colm.net/cgi-bin/mailman/listinfo/ragel [1]

_______________________________________________
ragel mailing list
ragel at colm.net
http://www.colm.net/cgi-bin/mailman/listinfo/ragel [1]

 

Links:
------
[1] http://www.colm.net/cgi-bin/mailman/listinfo/ragel
[2]
https://github.com/kurocha/async-http/tree/master/source/Async/HTTP/V1
[3] https://gist.github.com/ioquatix/2e50ffb09697107338f8f75083400143
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.colm.net/pipermail/ragel/attachments/20180127/1c7c31c8/attachment.html>

From space.ship.traveller at gmail.com  Sat Jan 27 22:53:42 2018
From: space.ship.traveller at gmail.com (Samuel Williams)
Date: Sun, 28 Jan 2018 11:53:42 +1300
Subject: [ragel] Ragel sanitise output - memory leaks
In-Reply-To: <0bd71775508a595c634b4ebf059588bf@mail.colm.net>
References: <CAHkN8V8x5W9Fz=Wi+DZvP7=jGQL22OoRhGbcsob3CGokGnyteQ@mail.gmail.com>
 <CAHkN8V8cE9=uL+fOd150KQNXkmK9agoRey1Fi0K_3jLD0nrdrA@mail.gmail.com>
 <2fe6a459b757842d0301a780398b9725@mail.colm.net>
 <CAHkN8V-jNgVeu3dhne0DTkXoiO3tixFcWw1Jk+LQFYG-x9hc2g@mail.gmail.com>
 <0bd71775508a595c634b4ebf059588bf@mail.colm.net>
Message-ID: <CAHkN8V9v4uELevwgXrRRs7=mpESAK9mChnf29jrw9ZTMy3DXYg@mail.gmail.com>

I'm not really sure how to answer your questions succinctly.

> Why so strict on building?

Using sanitisers is a great way to find issues in code. Enabling them
across the entire build provides useful feedback and identifies potential
issues. As an example, I also found potential memory alignment issues in
libpng, and zlib-ng.

Turning sanitisers on or off is a matter of choice, so one may choose not
to use them. However, in my case, when enabling them, they apply to all
aspects of the build including compiling the actual ragel binary, since
teapot builds everything from source including supporting tools.

If a tool exits with a non-zero exit status, it's considered a failure.
AFAIK, without being very explicit, I don't believe there is really any way
to tell if ragel failed because of a sanitizer issue or some other issue
with the exit status alone, so it's really just a matter of "the tool
failed, so the build failed". I think that's the right behaviour.

> Does it really matter if a tool used in the build doesn't free everything
before exiting?

If you just consider the nature of the tool and assuming the bug is simply
calling malloc without calling free, sure, I think we can be reasonable and
assume that it doesn't matter if it's a one shot process.

However, as I suggested, these problems might be covering up larger issues.
You won't know until you investigate them.

Additionally, if one chooses to ignore these issues, fair enough, but it's
possible that in the future a more serious issue would be lost in the
noise. I believe that's why things like "-Werror" exist, so that you can't
ignore warnings that might indicate potential problems. The code should
compile and run cleanly, and if not it warrants investigation IMHO.

Kind regards,
Samuel

On 28 January 2018 at 05:24, Adrian Thurston <thurston at colm.net> wrote:

> Why so strict on building? Does it really matter if a tool used in the a
> build doesn't free everything before exiting?
>
> On 2018-01-26 03:59, Samuel Williams wrote:
>
> When sanitisers are on, the exit status is non-zero because of the memory
> leaks, so it's not just clean build reports, but actually failed builds.
>
> Thanks
> Samuel
>
> On 14 December 2017 at 05:22, Adrian Thurston <thurston at colm.net> wrote:
>
>> Sorry, no change. The problems are in the form of memory leaks in ragel
>> mucking up your clean build reports? Maybe you could turn them off for
>> ragel? Honestly it's never really been a strong concern for me since ragel
>> is a one-shot kind of program. Some improvements were made when I added
>> libfsm, but that was mostly in the core FSM code.
>>
>> My current concerns with ragel are to get out-of-tree support for
>> alternate host languages. Will have some time for that in December.
>> Removing leaks is something I would work on when 7.0 gets to stable status.
>>
>> Adrian
>>
>> On 2017-11-08 20:08, Samuel Williams wrote:
>>
>> Any update to this? Still causing problems for me.
>>
>> On 9 October 2017 at 10:34, Samuel Williams <space.ship.traveller at gmail.
>> com> wrote:
>>
>>> Here is some log output from a build which invokes ragel to generate
>>> several parsers. I've cut out (most) unimportant output.
>>>
>>> The source code for the parsers: https://github.com/
>>> kurocha/async-http/tree/master/source/Async/HTTP/V1
>>>
>>> The results from running Ragel several times with LLVM sanitisers:
>>> https://gist.github.com/ioquatix/2e50ffb09697107338f8f75083400143
>>>
>>> The main issue I can see are memory leaks, but there could be other
>>> issues.
>>>
>>> Since Ragel is a one-shot "compiler", perhaps it's not important to
>>> address these, except as a matter of correctness.
>>>
>>> I think there are potential problem with memory leaks and they might be
>>> covering up bigger issues - there might be cases where memory is being
>>> accessed incorrectly but it's not causing a crash because it's not freed at
>>> the right point etc.
>>>
>>> I'd suggest that if there is a test suite for Ragel, it's updated to run
>>> with the undefined behaviour sanitiser and address sanitiser - both provide
>>> useful output IMHO.
>>>
>>> Happy to provide more feedback.
>>>
>>> Kind regards,
>>> Samuel
>>>
>>>
>> _______________________________________________
>> ragel mailing listragel at colm.nethttp://www.colm.net/cgi-bin/mailman/listinfo/ragel
>>
>>
>> _______________________________________________
>> ragel mailing list
>> ragel at colm.net
>> http://www.colm.net/cgi-bin/mailman/listinfo/ragel
>>
>
> _______________________________________________
> ragel mailing listragel at colm.nethttp://www.colm.net/cgi-bin/mailman/listinfo/ragel
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.colm.net/pipermail/ragel/attachments/20180128/796007fc/attachment.html>

From thurston at colm.net  Sun Jan 28 15:42:28 2018
From: thurston at colm.net (Adrian Thurston)
Date: Sun, 28 Jan 2018 10:42:28 -0500
Subject: [ragel] Ragel sanitise output - memory leaks
In-Reply-To: <CAHkN8V9v4uELevwgXrRRs7=mpESAK9mChnf29jrw9ZTMy3DXYg@mail.gmail.com>
References: <CAHkN8V8x5W9Fz=Wi+DZvP7=jGQL22OoRhGbcsob3CGokGnyteQ@mail.gmail.com>
 <CAHkN8V8cE9=uL+fOd150KQNXkmK9agoRey1Fi0K_3jLD0nrdrA@mail.gmail.com>
 <2fe6a459b757842d0301a780398b9725@mail.colm.net>
 <CAHkN8V-jNgVeu3dhne0DTkXoiO3tixFcWw1Jk+LQFYG-x9hc2g@mail.gmail.com>
 <0bd71775508a595c634b4ebf059588bf@mail.colm.net>
 <CAHkN8V9v4uELevwgXrRRs7=mpESAK9mChnf29jrw9ZTMy3DXYg@mail.gmail.com>
Message-ID: <89a7ab677726c8d41adadc7233033e06@mail.colm.net>

 

Yeah it's definitely valuable, I periodically do a run of development
centered around cleaning up leaks that impeded ongoing memory usage, but
if the free() is the last thing you're about to do before calling
exit(), I'd just rather call exit(). 

Adrian 

On 2018-01-27 17:53, Samuel Williams wrote: 

> I'm not really sure how to answer your questions succinctly. 
> 
>> Why so strict on building? 
> 
> Using sanitisers is a great way to find issues in code. Enabling them across the entire build provides useful feedback and identifies potential issues. As an example, I also found potential memory alignment issues in libpng, and zlib-ng. 
> 
> Turning sanitisers on or off is a matter of choice, so one may choose not to use them. However, in my case, when enabling them, they apply to all aspects of the build including compiling the actual ragel binary, since teapot builds everything from source including supporting tools. 
> 
> If a tool exits with a non-zero exit status, it's considered a failure. AFAIK, without being very explicit, I don't believe there is really any way to tell if ragel failed because of a sanitizer issue or some other issue with the exit status alone, so it's really just a matter of "the tool failed, so the build failed". I think that's the right behaviour. 
> 
>> Does it really matter if a tool used in the build doesn't free everything before exiting? 
> 
> If you just consider the nature of the tool and assuming the bug is simply calling malloc without calling free, sure, I think we can be reasonable and assume that it doesn't matter if it's a one shot process. 
> 
> However, as I suggested, these problems might be covering up larger issues. You won't know until you investigate them. 
> 
> Additionally, if one chooses to ignore these issues, fair enough, but it's possible that in the future a more serious issue would be lost in the noise. I believe that's why things like "-Werror" exist, so that you can't ignore warnings that might indicate potential problems. The code should compile and run cleanly, and if not it warrants investigation IMHO. 
> 
> Kind regards, 
> Samuel 
> 
> On 28 January 2018 at 05:24, Adrian Thurston <thurston at colm.net> wrote:
> 
> Why so strict on building? Does it really matter if a tool used in the a build doesn't free everything before exiting? 
> 
> On 2018-01-26 03:59, Samuel Williams wrote: 
> When sanitisers are on, the exit status is non-zero because of the memory leaks, so it's not just clean build reports, but actually failed builds. 
> 
> Thanks 
> Samuel
> 
> On 14 December 2017 at 05:22, Adrian Thurston <thurston at colm.net> wrote:
> 
> Sorry, no change. The problems are in the form of memory leaks in ragel mucking up your clean build reports? Maybe you could turn them off for ragel? Honestly it's never really been a strong concern for me since ragel is a one-shot kind of program. Some improvements were made when I added libfsm, but that was mostly in the core FSM code. 
> 
> My current concerns with ragel are to get out-of-tree support for alternate host languages. Will have some time for that in December. Removing leaks is something I would work on when 7.0 gets to stable status. 
> 
> Adrian 
> 
> On 2017-11-08 20:08, Samuel Williams wrote: 
> 
> Any update to this? Still causing problems for me. 
> 
> On 9 October 2017 at 10:34, Samuel Williams <space.ship.traveller at gmail.com> wrote:
> 
> Here is some log output from a build which invokes ragel to generate several parsers. I've cut out (most) unimportant output. 
> 
> The source code for the parsers: https://github.com/kurocha/async-http/tree/master/source/Async/HTTP/V1 [2] 
> The results from running Ragel several times with LLVM sanitisers: https://gist.github.com/ioquatix/2e50ffb09697107338f8f75083400143 [3]
> 
> The main issue I can see are memory leaks, but there could be other issues. 
> 
> Since Ragel is a one-shot "compiler", perhaps it's not important to address these, except as a matter of correctness. 
> 
> I think there are potential problem with memory leaks and they might be covering up bigger issues - there might be cases where memory is being accessed incorrectly but it's not causing a crash because it's not freed at the right point etc. 
> 
> I'd suggest that if there is a test suite for Ragel, it's updated to run with the undefined behaviour sanitiser and address sanitiser - both provide useful output IMHO. 
> 
> Happy to provide more feedback. 
> 
> Kind regards, 
> Samuel 
> 
> _______________________________________________
> ragel mailing list
> ragel at colm.net
> http://www.colm.net/cgi-bin/mailman/listinfo/ragel [1]

_______________________________________________
 ragel mailing list
 ragel at colm.net
 http://www.colm.net/cgi-bin/mailman/listinfo/ragel [1] 

_______________________________________________
ragel mailing list
ragel at colm.net
http://www.colm.net/cgi-bin/mailman/listinfo/ragel [1]

 

Links:
------
[1] http://www.colm.net/cgi-bin/mailman/listinfo/ragel
[2]
https://github.com/kurocha/async-http/tree/master/source/Async/HTTP/V1
[3] https://gist.github.com/ioquatix/2e50ffb09697107338f8f75083400143
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.colm.net/pipermail/ragel/attachments/20180128/b051164c/attachment.html>

From thurston at colm.net  Wed Jan 31 17:09:21 2018
From: thurston at colm.net (Adrian Thurston)
Date: Wed, 31 Jan 2018 12:09:21 -0500
Subject: [ragel] git repository URIs
Message-ID: <80c04e1a2995cfe36cc526af0801af7a@mail.colm.net>

Hi, the git repository URIs have changed:

git clone git://colm.net/colm.git
git clone git://colm.net/ragel.git

Cheers,
  Adrian

-- 
Dr. Adrian D. Thurston
Chief Scientist
Colm Networks
http://colm.net/



From space.ship.traveller at gmail.com  Fri Jan 26 08:59:00 2018
From: space.ship.traveller at gmail.com (Samuel Williams)
Date: Fri, 26 Jan 2018 21:59:00 +1300
Subject: [ragel] Ragel sanitise output - memory leaks
In-Reply-To: <2fe6a459b757842d0301a780398b9725@mail.colm.net>
References: <CAHkN8V8x5W9Fz=Wi+DZvP7=jGQL22OoRhGbcsob3CGokGnyteQ@mail.gmail.com>
 <CAHkN8V8cE9=uL+fOd150KQNXkmK9agoRey1Fi0K_3jLD0nrdrA@mail.gmail.com>
 <2fe6a459b757842d0301a780398b9725@mail.colm.net>
Message-ID: <CAHkN8V-jNgVeu3dhne0DTkXoiO3tixFcWw1Jk+LQFYG-x9hc2g@mail.gmail.com>

When sanitisers are on, the exit status is non-zero because of the memory
leaks, so it's not just clean build reports, but actually failed builds.

Thanks
Samuel

On 14 December 2017 at 05:22, Adrian Thurston <thurston at colm.net> wrote:

> Sorry, no change. The problems are in the form of memory leaks in ragel
> mucking up your clean build reports? Maybe you could turn them off for
> ragel? Honestly it's never really been a strong concern for me since ragel
> is a one-shot kind of program. Some improvements were made when I added
> libfsm, but that was mostly in the core FSM code.
>
> My current concerns with ragel are to get out-of-tree support for
> alternate host languages. Will have some time for that in December.
> Removing leaks is something I would work on when 7.0 gets to stable status.
>
> Adrian
>
> On 2017-11-08 20:08, Samuel Williams wrote:
>
> Any update to this? Still causing problems for me.
>
> On 9 October 2017 at 10:34, Samuel Williams <space.ship.traveller at gmail.
> com> wrote:
>
>> Here is some log output from a build which invokes ragel to generate
>> several parsers. I've cut out (most) unimportant output.
>>
>> The source code for the parsers: https://github.com/
>> kurocha/async-http/tree/master/source/Async/HTTP/V1
>>
>> The results from running Ragel several times with LLVM sanitisers:
>> https://gist.github.com/ioquatix/2e50ffb09697107338f8f75083400143
>>
>> The main issue I can see are memory leaks, but there could be other
>> issues.
>>
>> Since Ragel is a one-shot "compiler", perhaps it's not important to
>> address these, except as a matter of correctness.
>>
>> I think there are potential problem with memory leaks and they might be
>> covering up bigger issues - there might be cases where memory is being
>> accessed incorrectly but it's not causing a crash because it's not freed at
>> the right point etc.
>>
>> I'd suggest that if there is a test suite for Ragel, it's updated to run
>> with the undefined behaviour sanitiser and address sanitiser - both provide
>> useful output IMHO.
>>
>> Happy to provide more feedback.
>>
>> Kind regards,
>> Samuel
>>
>>
>
> _______________________________________________
> ragel mailing listragel at colm.nethttp://www.colm.net/cgi-bin/mailman/listinfo/ragel
>
>
> _______________________________________________
> ragel mailing list
> ragel at colm.net
> http://www.colm.net/cgi-bin/mailman/listinfo/ragel
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.colm.net/pipermail/ragel-users/attachments/20180126/cc46aa90/attachment-0002.html>

From ferfebles at gmail.com  Sat Jan 27 09:41:42 2018
From: ferfebles at gmail.com (fer febles)
Date: Sat, 27 Jan 2018 09:41:42 +0000
Subject: [ragel] Using Ragel in the firmware of a keyboard
Message-ID: <CAKg5eAdPd6VDTK-DFWOsnBFmFv0RQ=bpvgLCqceSEzZeApTG-Q@mail.gmail.com>

Hi Adrian,

I'm using a small state machine to implement the logic for changing layers
in a small DIY keyboard called the Atreus:
https://github.com/ferfebles/atreus-2leds1speaker-ragel

It's being a fun and rewarding project. I just wanted to thank you for the
Ragel compiler and show you an apparently simple problem that was almost
impossible to be done right by hand.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.colm.net/pipermail/ragel-users/attachments/20180127/719d66d4/attachment-0002.html>

From thurston at colm.net  Sat Jan 27 16:22:55 2018
From: thurston at colm.net (Adrian Thurston)
Date: Sat, 27 Jan 2018 11:22:55 -0500
Subject: [ragel] Using Ragel in the firmware of a keyboard
In-Reply-To: <CAKg5eAdPd6VDTK-DFWOsnBFmFv0RQ=bpvgLCqceSEzZeApTG-Q@mail.gmail.com>
References: <CAKg5eAdPd6VDTK-DFWOsnBFmFv0RQ=bpvgLCqceSEzZeApTG-Q@mail.gmail.com>
Message-ID: <000e02de3029daf52ec49cffc21a4513@mail.colm.net>

 

Thanks for the note, I appreciate the feedback. 

On 2018-01-27 04:41, fer febles wrote: 

> Hi Adrian, 
> 
> I'm using a small state machine to implement the logic for changing layers in a small DIY keyboard called the Atreus: https://github.com/ferfebles/atreus-2leds1speaker-ragel [2] 
> 
> It's being a fun and rewarding project. I just wanted to thank you for the Ragel compiler and show you an apparently simple problem that was almost impossible to be done right by hand. 
> 
> _______________________________________________
> ragel mailing list
> ragel at colm.net
> http://www.colm.net/cgi-bin/mailman/listinfo/ragel [1]
 

Links:
------
[1] http://www.colm.net/cgi-bin/mailman/listinfo/ragel
[2] https://github.com/ferfebles/atreus-2leds1speaker-ragel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.colm.net/pipermail/ragel-users/attachments/20180127/389c4c65/attachment-0002.html>

From thurston at colm.net  Sat Jan 27 16:24:07 2018
From: thurston at colm.net (Adrian Thurston)
Date: Sat, 27 Jan 2018 11:24:07 -0500
Subject: [ragel] Ragel sanitise output - memory leaks
In-Reply-To: <CAHkN8V-jNgVeu3dhne0DTkXoiO3tixFcWw1Jk+LQFYG-x9hc2g@mail.gmail.com>
References: <CAHkN8V8x5W9Fz=Wi+DZvP7=jGQL22OoRhGbcsob3CGokGnyteQ@mail.gmail.com>
 <CAHkN8V8cE9=uL+fOd150KQNXkmK9agoRey1Fi0K_3jLD0nrdrA@mail.gmail.com>
 <2fe6a459b757842d0301a780398b9725@mail.colm.net>
 <CAHkN8V-jNgVeu3dhne0DTkXoiO3tixFcWw1Jk+LQFYG-x9hc2g@mail.gmail.com>
Message-ID: <0bd71775508a595c634b4ebf059588bf@mail.colm.net>

 

Why so strict on building? Does it really matter if a tool used in the a
build doesn't free everything before exiting? 

On 2018-01-26 03:59, Samuel Williams wrote: 

> When sanitisers are on, the exit status is non-zero because of the memory leaks, so it's not just clean build reports, but actually failed builds. 
> 
> Thanks 
> Samuel
> 
> On 14 December 2017 at 05:22, Adrian Thurston <thurston at colm.net> wrote:
> 
> Sorry, no change. The problems are in the form of memory leaks in ragel mucking up your clean build reports? Maybe you could turn them off for ragel? Honestly it's never really been a strong concern for me since ragel is a one-shot kind of program. Some improvements were made when I added libfsm, but that was mostly in the core FSM code. 
> 
> My current concerns with ragel are to get out-of-tree support for alternate host languages. Will have some time for that in December. Removing leaks is something I would work on when 7.0 gets to stable status. 
> 
> Adrian 
> 
> On 2017-11-08 20:08, Samuel Williams wrote: 
> 
> Any update to this? Still causing problems for me. 
> 
> On 9 October 2017 at 10:34, Samuel Williams <space.ship.traveller at gmail.com> wrote:
> 
> Here is some log output from a build which invokes ragel to generate several parsers. I've cut out (most) unimportant output. 
> 
> The source code for the parsers: https://github.com/kurocha/async-http/tree/master/source/Async/HTTP/V1 [2] 
> The results from running Ragel several times with LLVM sanitisers: https://gist.github.com/ioquatix/2e50ffb09697107338f8f75083400143 [3]
> 
> The main issue I can see are memory leaks, but there could be other issues. 
> 
> Since Ragel is a one-shot "compiler", perhaps it's not important to address these, except as a matter of correctness. 
> 
> I think there are potential problem with memory leaks and they might be covering up bigger issues - there might be cases where memory is being accessed incorrectly but it's not causing a crash because it's not freed at the right point etc. 
> 
> I'd suggest that if there is a test suite for Ragel, it's updated to run with the undefined behaviour sanitiser and address sanitiser - both provide useful output IMHO. 
> 
> Happy to provide more feedback. 
> 
> Kind regards, 
> Samuel 
> 
> _______________________________________________
> ragel mailing list
> ragel at colm.net
> http://www.colm.net/cgi-bin/mailman/listinfo/ragel [1]

_______________________________________________
 ragel mailing list
 ragel at colm.net
 http://www.colm.net/cgi-bin/mailman/listinfo/ragel [1]

_______________________________________________
ragel mailing list
ragel at colm.net
http://www.colm.net/cgi-bin/mailman/listinfo/ragel [1]

 

Links:
------
[1] http://www.colm.net/cgi-bin/mailman/listinfo/ragel
[2]
https://github.com/kurocha/async-http/tree/master/source/Async/HTTP/V1
[3] https://gist.github.com/ioquatix/2e50ffb09697107338f8f75083400143
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.colm.net/pipermail/ragel-users/attachments/20180127/1c7c31c8/attachment-0002.html>

From space.ship.traveller at gmail.com  Sat Jan 27 22:53:42 2018
From: space.ship.traveller at gmail.com (Samuel Williams)
Date: Sun, 28 Jan 2018 11:53:42 +1300
Subject: [ragel] Ragel sanitise output - memory leaks
In-Reply-To: <0bd71775508a595c634b4ebf059588bf@mail.colm.net>
References: <CAHkN8V8x5W9Fz=Wi+DZvP7=jGQL22OoRhGbcsob3CGokGnyteQ@mail.gmail.com>
 <CAHkN8V8cE9=uL+fOd150KQNXkmK9agoRey1Fi0K_3jLD0nrdrA@mail.gmail.com>
 <2fe6a459b757842d0301a780398b9725@mail.colm.net>
 <CAHkN8V-jNgVeu3dhne0DTkXoiO3tixFcWw1Jk+LQFYG-x9hc2g@mail.gmail.com>
 <0bd71775508a595c634b4ebf059588bf@mail.colm.net>
Message-ID: <CAHkN8V9v4uELevwgXrRRs7=mpESAK9mChnf29jrw9ZTMy3DXYg@mail.gmail.com>

I'm not really sure how to answer your questions succinctly.

> Why so strict on building?

Using sanitisers is a great way to find issues in code. Enabling them
across the entire build provides useful feedback and identifies potential
issues. As an example, I also found potential memory alignment issues in
libpng, and zlib-ng.

Turning sanitisers on or off is a matter of choice, so one may choose not
to use them. However, in my case, when enabling them, they apply to all
aspects of the build including compiling the actual ragel binary, since
teapot builds everything from source including supporting tools.

If a tool exits with a non-zero exit status, it's considered a failure.
AFAIK, without being very explicit, I don't believe there is really any way
to tell if ragel failed because of a sanitizer issue or some other issue
with the exit status alone, so it's really just a matter of "the tool
failed, so the build failed". I think that's the right behaviour.

> Does it really matter if a tool used in the build doesn't free everything
before exiting?

If you just consider the nature of the tool and assuming the bug is simply
calling malloc without calling free, sure, I think we can be reasonable and
assume that it doesn't matter if it's a one shot process.

However, as I suggested, these problems might be covering up larger issues.
You won't know until you investigate them.

Additionally, if one chooses to ignore these issues, fair enough, but it's
possible that in the future a more serious issue would be lost in the
noise. I believe that's why things like "-Werror" exist, so that you can't
ignore warnings that might indicate potential problems. The code should
compile and run cleanly, and if not it warrants investigation IMHO.

Kind regards,
Samuel

On 28 January 2018 at 05:24, Adrian Thurston <thurston at colm.net> wrote:

> Why so strict on building? Does it really matter if a tool used in the a
> build doesn't free everything before exiting?
>
> On 2018-01-26 03:59, Samuel Williams wrote:
>
> When sanitisers are on, the exit status is non-zero because of the memory
> leaks, so it's not just clean build reports, but actually failed builds.
>
> Thanks
> Samuel
>
> On 14 December 2017 at 05:22, Adrian Thurston <thurston at colm.net> wrote:
>
>> Sorry, no change. The problems are in the form of memory leaks in ragel
>> mucking up your clean build reports? Maybe you could turn them off for
>> ragel? Honestly it's never really been a strong concern for me since ragel
>> is a one-shot kind of program. Some improvements were made when I added
>> libfsm, but that was mostly in the core FSM code.
>>
>> My current concerns with ragel are to get out-of-tree support for
>> alternate host languages. Will have some time for that in December.
>> Removing leaks is something I would work on when 7.0 gets to stable status.
>>
>> Adrian
>>
>> On 2017-11-08 20:08, Samuel Williams wrote:
>>
>> Any update to this? Still causing problems for me.
>>
>> On 9 October 2017 at 10:34, Samuel Williams <space.ship.traveller at gmail.
>> com> wrote:
>>
>>> Here is some log output from a build which invokes ragel to generate
>>> several parsers. I've cut out (most) unimportant output.
>>>
>>> The source code for the parsers: https://github.com/
>>> kurocha/async-http/tree/master/source/Async/HTTP/V1
>>>
>>> The results from running Ragel several times with LLVM sanitisers:
>>> https://gist.github.com/ioquatix/2e50ffb09697107338f8f75083400143
>>>
>>> The main issue I can see are memory leaks, but there could be other
>>> issues.
>>>
>>> Since Ragel is a one-shot "compiler", perhaps it's not important to
>>> address these, except as a matter of correctness.
>>>
>>> I think there are potential problem with memory leaks and they might be
>>> covering up bigger issues - there might be cases where memory is being
>>> accessed incorrectly but it's not causing a crash because it's not freed at
>>> the right point etc.
>>>
>>> I'd suggest that if there is a test suite for Ragel, it's updated to run
>>> with the undefined behaviour sanitiser and address sanitiser - both provide
>>> useful output IMHO.
>>>
>>> Happy to provide more feedback.
>>>
>>> Kind regards,
>>> Samuel
>>>
>>>
>> _______________________________________________
>> ragel mailing listragel at colm.nethttp://www.colm.net/cgi-bin/mailman/listinfo/ragel
>>
>>
>> _______________________________________________
>> ragel mailing list
>> ragel at colm.net
>> http://www.colm.net/cgi-bin/mailman/listinfo/ragel
>>
>
> _______________________________________________
> ragel mailing listragel at colm.nethttp://www.colm.net/cgi-bin/mailman/listinfo/ragel
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.colm.net/pipermail/ragel-users/attachments/20180128/796007fc/attachment-0002.html>

From thurston at colm.net  Sun Jan 28 15:42:28 2018
From: thurston at colm.net (Adrian Thurston)
Date: Sun, 28 Jan 2018 10:42:28 -0500
Subject: [ragel] Ragel sanitise output - memory leaks
In-Reply-To: <CAHkN8V9v4uELevwgXrRRs7=mpESAK9mChnf29jrw9ZTMy3DXYg@mail.gmail.com>
References: <CAHkN8V8x5W9Fz=Wi+DZvP7=jGQL22OoRhGbcsob3CGokGnyteQ@mail.gmail.com>
 <CAHkN8V8cE9=uL+fOd150KQNXkmK9agoRey1Fi0K_3jLD0nrdrA@mail.gmail.com>
 <2fe6a459b757842d0301a780398b9725@mail.colm.net>
 <CAHkN8V-jNgVeu3dhne0DTkXoiO3tixFcWw1Jk+LQFYG-x9hc2g@mail.gmail.com>
 <0bd71775508a595c634b4ebf059588bf@mail.colm.net>
 <CAHkN8V9v4uELevwgXrRRs7=mpESAK9mChnf29jrw9ZTMy3DXYg@mail.gmail.com>
Message-ID: <89a7ab677726c8d41adadc7233033e06@mail.colm.net>

 

Yeah it's definitely valuable, I periodically do a run of development
centered around cleaning up leaks that impeded ongoing memory usage, but
if the free() is the last thing you're about to do before calling
exit(), I'd just rather call exit(). 

Adrian 

On 2018-01-27 17:53, Samuel Williams wrote: 

> I'm not really sure how to answer your questions succinctly. 
> 
>> Why so strict on building? 
> 
> Using sanitisers is a great way to find issues in code. Enabling them across the entire build provides useful feedback and identifies potential issues. As an example, I also found potential memory alignment issues in libpng, and zlib-ng. 
> 
> Turning sanitisers on or off is a matter of choice, so one may choose not to use them. However, in my case, when enabling them, they apply to all aspects of the build including compiling the actual ragel binary, since teapot builds everything from source including supporting tools. 
> 
> If a tool exits with a non-zero exit status, it's considered a failure. AFAIK, without being very explicit, I don't believe there is really any way to tell if ragel failed because of a sanitizer issue or some other issue with the exit status alone, so it's really just a matter of "the tool failed, so the build failed". I think that's the right behaviour. 
> 
>> Does it really matter if a tool used in the build doesn't free everything before exiting? 
> 
> If you just consider the nature of the tool and assuming the bug is simply calling malloc without calling free, sure, I think we can be reasonable and assume that it doesn't matter if it's a one shot process. 
> 
> However, as I suggested, these problems might be covering up larger issues. You won't know until you investigate them. 
> 
> Additionally, if one chooses to ignore these issues, fair enough, but it's possible that in the future a more serious issue would be lost in the noise. I believe that's why things like "-Werror" exist, so that you can't ignore warnings that might indicate potential problems. The code should compile and run cleanly, and if not it warrants investigation IMHO. 
> 
> Kind regards, 
> Samuel 
> 
> On 28 January 2018 at 05:24, Adrian Thurston <thurston at colm.net> wrote:
> 
> Why so strict on building? Does it really matter if a tool used in the a build doesn't free everything before exiting? 
> 
> On 2018-01-26 03:59, Samuel Williams wrote: 
> When sanitisers are on, the exit status is non-zero because of the memory leaks, so it's not just clean build reports, but actually failed builds. 
> 
> Thanks 
> Samuel
> 
> On 14 December 2017 at 05:22, Adrian Thurston <thurston at colm.net> wrote:
> 
> Sorry, no change. The problems are in the form of memory leaks in ragel mucking up your clean build reports? Maybe you could turn them off for ragel? Honestly it's never really been a strong concern for me since ragel is a one-shot kind of program. Some improvements were made when I added libfsm, but that was mostly in the core FSM code. 
> 
> My current concerns with ragel are to get out-of-tree support for alternate host languages. Will have some time for that in December. Removing leaks is something I would work on when 7.0 gets to stable status. 
> 
> Adrian 
> 
> On 2017-11-08 20:08, Samuel Williams wrote: 
> 
> Any update to this? Still causing problems for me. 
> 
> On 9 October 2017 at 10:34, Samuel Williams <space.ship.traveller at gmail.com> wrote:
> 
> Here is some log output from a build which invokes ragel to generate several parsers. I've cut out (most) unimportant output. 
> 
> The source code for the parsers: https://github.com/kurocha/async-http/tree/master/source/Async/HTTP/V1 [2] 
> The results from running Ragel several times with LLVM sanitisers: https://gist.github.com/ioquatix/2e50ffb09697107338f8f75083400143 [3]
> 
> The main issue I can see are memory leaks, but there could be other issues. 
> 
> Since Ragel is a one-shot "compiler", perhaps it's not important to address these, except as a matter of correctness. 
> 
> I think there are potential problem with memory leaks and they might be covering up bigger issues - there might be cases where memory is being accessed incorrectly but it's not causing a crash because it's not freed at the right point etc. 
> 
> I'd suggest that if there is a test suite for Ragel, it's updated to run with the undefined behaviour sanitiser and address sanitiser - both provide useful output IMHO. 
> 
> Happy to provide more feedback. 
> 
> Kind regards, 
> Samuel 
> 
> _______________________________________________
> ragel mailing list
> ragel at colm.net
> http://www.colm.net/cgi-bin/mailman/listinfo/ragel [1]

_______________________________________________
 ragel mailing list
 ragel at colm.net
 http://www.colm.net/cgi-bin/mailman/listinfo/ragel [1] 

_______________________________________________
ragel mailing list
ragel at colm.net
http://www.colm.net/cgi-bin/mailman/listinfo/ragel [1]

 

Links:
------
[1] http://www.colm.net/cgi-bin/mailman/listinfo/ragel
[2]
https://github.com/kurocha/async-http/tree/master/source/Async/HTTP/V1
[3] https://gist.github.com/ioquatix/2e50ffb09697107338f8f75083400143
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.colm.net/pipermail/ragel-users/attachments/20180128/b051164c/attachment-0002.html>

From thurston at colm.net  Wed Jan 31 17:09:21 2018
From: thurston at colm.net (Adrian Thurston)
Date: Wed, 31 Jan 2018 12:09:21 -0500
Subject: [ragel] git repository URIs
Message-ID: <80c04e1a2995cfe36cc526af0801af7a@mail.colm.net>

Hi, the git repository URIs have changed:

git clone git://colm.net/colm.git
git clone git://colm.net/ragel.git

Cheers,
  Adrian

-- 
Dr. Adrian D. Thurston
Chief Scientist
Colm Networks
http://colm.net/




