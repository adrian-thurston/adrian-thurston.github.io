<tt>
&lt;html&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;<br>
In&nbsp;RedCloth,&nbsp;we&nbsp;have&nbsp;a&nbsp;problem&nbsp;where&nbsp;an&nbsp;_emphasized_&nbsp;bit&nbsp;of&nbsp;text&nbsp;can&nbsp;have&nbsp;_(myclass#myid)a&nbsp;CSS&nbsp;class&nbsp;and/or&nbsp;id_&nbsp;but&nbsp;shouldn't&nbsp;have&nbsp;a&nbsp;class&nbsp;or&nbsp;id&nbsp;if&nbsp;the&nbsp;whole&nbsp;emphasis&nbsp;is&nbsp;in&nbsp;parentheses&nbsp;_(practically&nbsp;speaking)_.&nbsp; Consider&nbsp;this&nbsp;example&nbsp;(simplified): &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;in:&nbsp;&quot;before&nbsp;_(in&nbsp;parens)_&nbsp;after&quot;&lt;/div&gt;&lt;div&gt;expected:&nbsp;&quot;&lt;p&gt;before&nbsp;&lt;em&gt;(in&nbsp;parens)&lt;/em&gt;&nbsp;after&lt;/p&gt;&quot;&lt;/div&gt;&lt;div&gt;but&nbsp;was:&nbsp;&quot;&lt;p&gt;before&nbsp;&lt;em&nbsp;class=\&quot;in&nbsp;parens\&quot;&gt;in&nbsp;parens)&lt;/em&gt;&nbsp;after&lt;/p&gt;&quot;&lt;/div&gt;&lt;div&gt;It&nbsp;simultaneously&nbsp;pursues&nbsp;the&nbsp;possibilities&nbsp;that&nbsp;the&nbsp;parenthesized&nbsp;text&nbsp;is&nbsp;the&nbsp;class&nbsp;and&nbsp;that&nbsp;it's&nbsp;just&nbsp;regular&nbsp;parenthesized&nbsp;text&nbsp;inside&nbsp;the&nbsp;em.&nbsp; When&nbsp;the&nbsp;class&nbsp;possibility&nbsp;doesn't&nbsp;work&nbsp;out,&nbsp;the&nbsp;final&nbsp;state&nbsp;is&nbsp;the&nbsp;regular&nbsp;text&nbsp;part&nbsp;but&nbsp;the&nbsp;class&nbsp;has&nbsp;already&nbsp;been&nbsp;captured.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;C&nbsp;=&nbsp;&quot;(&quot;&nbsp;(&nbsp;[^)#]+&nbsp;&gt;A&nbsp;%{&nbsp;STORE(class)&nbsp;}&nbsp;)?&nbsp;(&quot;#&quot;&nbsp;[^)]+&nbsp;&gt;A&nbsp;%{STORE(id)}&nbsp;)?&nbsp;&quot;)&quot; &lt;/div&gt;&lt;div&gt;&lt;div&gt;mtext&nbsp;=&nbsp;(&nbsp;chars&nbsp;(mspace&nbsp;chars)*&nbsp;)&nbsp;;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;em&nbsp;=&nbsp;&quot;_&quot;&nbsp;&gt;X&nbsp;C?&nbsp;mtext&nbsp;&gt;A&nbsp;%T&nbsp;:&gt;&nbsp;&quot;_&quot;&nbsp;;&lt;/div&gt;&lt;div&gt;#&nbsp;The&nbsp;&gt;X&nbsp;resets&nbsp;the&nbsp;register&nbsp;from&nbsp;the&nbsp;last&nbsp;match,&nbsp;&gt;A&nbsp;registers&nbsp;the&nbsp;beginning&nbsp;of&nbsp;a&nbsp;string&nbsp;and&nbsp;the&nbsp;STORE&nbsp;saves&nbsp;it&nbsp;away.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;tried&nbsp;having&nbsp;the&nbsp;class&nbsp;info&nbsp;get&nbsp;written&nbsp;to&nbsp;a&nbsp;buffer&nbsp;that&nbsp;was&nbsp;then&nbsp;captured&nbsp;with&nbsp;a&nbsp;leaving&nbsp;action,&nbsp;which&nbsp;works&nbsp;for&nbsp;the&nbsp;class&nbsp;part,&nbsp;but&nbsp;I&nbsp;again&nbsp;run&nbsp;into&nbsp;the&nbsp;same&nbsp;problem&nbsp;with&nbsp;capturing&nbsp;the&nbsp;text&nbsp;because&nbsp;the&nbsp;right&nbsp;side&nbsp;of&nbsp;the&nbsp;union&nbsp;matches&nbsp;also,&nbsp;so&nbsp;it&nbsp;captures&nbsp;too&nbsp;much&nbsp;text.&nbsp; Whichever&nbsp;side&nbsp;of&nbsp;the&nbsp;vertical&nbsp;pipe&nbsp;writes&nbsp;last,&nbsp;wins.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;C&nbsp;=&nbsp;&quot;(&quot;&nbsp;(&nbsp;[^)#]+&nbsp;&gt;A&nbsp;%{&nbsp;STORE(class&lt;b&gt;_bu&lt;/b&gt;f)&nbsp;}&nbsp;)?&nbsp;(&quot;#&quot;&nbsp;[^)]+&nbsp;&gt;A&nbsp;%{STORE(id&lt;b&gt;_buf&lt;/b&gt;)}&nbsp;)?&nbsp;&quot;)&quot; &lt;/div&gt;&lt;div&gt;C_mtext&nbsp;=&nbsp;(C&nbsp;%{&nbsp;STORE_ATTRIBUTES();&nbsp;}&nbsp;mtext&nbsp;&gt;A&nbsp;%{STORE(text)}&nbsp;|&nbsp;mtext&nbsp;&gt;B&nbsp;%{&nbsp;STORE_B(text);&nbsp;});&lt;/div&gt;&lt;div&gt;#&nbsp;SET_ATTRIBUTES&nbsp;copies&nbsp;the&nbsp;attributes&nbsp;from&nbsp;their&nbsp;buffers&nbsp;and&nbsp;stores&nbsp;them&nbsp;where&nbsp;they&nbsp;belong.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;results&nbsp;in...&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;expected:&nbsp;&quot;&lt;p&gt;&lt;span&nbsp;class=\&quot;myclass\&quot;&gt;SPAN&lt;/span&gt;&lt;/p&gt;&quot;&lt;/div&gt;&lt;div&gt; but&nbsp;was:&nbsp;&quot;&lt;p&gt;&lt;span&nbsp;class=\&quot;myclass\&quot;&gt;(myclass)SPAN&lt;/span&gt;&lt;/p&gt;&quot;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Really&nbsp;what&nbsp;I&nbsp;want&nbsp;is&nbsp;for&nbsp;it&nbsp;to&nbsp;try&nbsp;the&nbsp;first&nbsp;pattern&nbsp;(with&nbsp;the&nbsp;C)&nbsp;and,&nbsp;if&nbsp;that&nbsp;fails,&nbsp;try&nbsp;the&nbsp;second&nbsp;(the&nbsp;plain&nbsp;ol'&nbsp;mtext).&nbsp; Sounds&nbsp;like&nbsp;a&nbsp;scanner&nbsp;to&nbsp;me.&nbsp; Problem&nbsp;is,&nbsp;I'm&nbsp;already&nbsp;inside&nbsp;a&nbsp;scanner,&nbsp;so&nbsp;it&nbsp;won't&nbsp;let&nbsp;me&nbsp;call&nbsp;a&nbsp;scanner&nbsp;from&nbsp;within&nbsp;a&nbsp;pattern.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Got&nbsp;any&nbsp;ideas?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Jason&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
