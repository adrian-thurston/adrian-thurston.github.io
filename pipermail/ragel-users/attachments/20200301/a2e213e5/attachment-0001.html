<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;a&nbsp;finite&nbsp;state&nbsp;machine,&nbsp;having&nbsp;read&nbsp;the&nbsp;&quot;3&quot;,&nbsp;cannot&nbsp;know&nbsp;if&nbsp;the&nbsp;parser&nbsp;is&nbsp;&quot;done&quot;&nbsp;or&nbsp;not&nbsp;-&nbsp;only&nbsp;that&nbsp;it&nbsp;in&nbsp;a&nbsp;certain&nbsp;state.&nbsp;You&nbsp;have&nbsp;a&nbsp;couple&nbsp;of&nbsp;options&nbsp;that&nbsp;I&nbsp;know:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;Add&nbsp;some&nbsp;&quot;end-of-string&quot;&nbsp;sentinel&nbsp;value&nbsp;(like&nbsp;a&nbsp;null&nbsp;terminator)&lt;/div&gt;&lt;div&gt;*&nbsp;Use&nbsp;first_final&nbsp;instead&nbsp;of&nbsp;state&nbsp;transition&nbsp;actions&lt;/div&gt;&lt;div&gt;*&nbsp;Use&nbsp;EOF&nbsp;actions&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;the&nbsp;&#39;first_final&#39;&nbsp;method,&nbsp;you&nbsp;would&nbsp;essentially&nbsp;do&nbsp;something&nbsp;like&nbsp;what&nbsp;is&nbsp;described&nbsp;in&nbsp;the&nbsp;ragel&nbsp;guide:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;parser_parse(&amp;parser,&nbsp;str,&nbsp;strlen(str));&lt;/div&gt;&lt;div&gt;if&nbsp;(&nbsp;parser.cs&nbsp;&lt;&nbsp;%%{&nbsp;write&nbsp;first_final;&nbsp;}%%&nbsp;)&nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp;printf(&quot;parsing&nbsp;failed\n&quot;);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;downside&nbsp;with&nbsp;this&nbsp;is&nbsp;that&nbsp;partial&nbsp;reads&nbsp;are&nbsp;no&nbsp;longer&nbsp;supported,&nbsp;e.g.&nbsp;when&lt;/div&gt;&lt;div&gt;*&nbsp;reading&nbsp;larger&nbsp;data&nbsp;sets,&nbsp;like&nbsp;reading&nbsp;network&nbsp;logs&nbsp;from&nbsp;a&nbsp;file&lt;/div&gt;&lt;div&gt;*&nbsp;reading&nbsp;data&nbsp;over&nbsp;a&nbsp;network&nbsp;or&nbsp;some&nbsp;serial&nbsp;communication&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;a&nbsp;normal&nbsp;loop&nbsp;over&nbsp;these&nbsp;might&nbsp;look&nbsp;like&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;char&nbsp;buf[BUFLEN];&lt;/div&gt;&lt;div&gt;bytes_read&nbsp;=&nbsp;read(fd,&nbsp;&amp;buf,&nbsp;BUFLEN); &lt;/div&gt;&lt;div&gt;while&nbsp;(bytes_read&nbsp;&gt;&nbsp;0)&nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp;parser_parse(&amp;parser,&nbsp;buf,&nbsp;bytes_read);&lt;/div&gt;&lt;div&gt; &nbsp;bytes_read&nbsp;=&nbsp;read(fd,&nbsp;&amp;buf,&nbsp;BUFLEN);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;and&nbsp;a&nbsp;certain&nbsp;read&nbsp;might&nbsp;have&nbsp;read&nbsp;exactly&nbsp;3&nbsp;characters,&nbsp;&quot;123&quot;,&nbsp;but&nbsp;you&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;the&nbsp;next&nbsp;read&nbsp;will&nbsp;get&nbsp;you&nbsp;&quot;456789&quot;&nbsp;or&nbsp;EOF&nbsp;-&nbsp;but&nbsp;&quot;cs&quot;&nbsp;is&nbsp;in&nbsp;a&nbsp;final&nbsp;state.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;the&nbsp;first&nbsp;method,&nbsp;you&nbsp;would&nbsp;define&nbsp;a&nbsp;parser&nbsp;like&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;foo&nbsp;=&nbsp;(&#39;123&#39;&nbsp;0)&nbsp;|&nbsp;(&#39;12345&#39;&nbsp;0)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;then&nbsp;the&nbsp;finishing&nbsp;state&nbsp;action&nbsp;would&nbsp;occur&nbsp;on&nbsp;the&nbsp;null&nbsp;terminator.&nbsp;You&nbsp;would&nbsp;call&nbsp;your&nbsp;parser&nbsp;like&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;parser_parse(&amp;parser,&nbsp;str,&nbsp;strlen(str)+1);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;or,&nbsp;while&nbsp;over&nbsp;a&nbsp;network,&nbsp;you&nbsp;could&nbsp;do&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;char&nbsp;buf[BUFLEN];&lt;/div&gt;&lt;div&gt;bytes_read&nbsp;=&nbsp;read(fd,&nbsp;&amp;buf,&nbsp;BUFLEN);&lt;/div&gt;&lt;div&gt;while&nbsp;(bytes_read&nbsp;&gt;&nbsp;0)&nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp;parser_parse(&amp;parser,&nbsp;buf,&nbsp;bytes_read);&lt;/div&gt;&lt;div&gt; &nbsp;bytes_read&nbsp;=&nbsp;read(fd,&nbsp;&amp;buf,&nbsp;BUFLEN):&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;if&nbsp;(0&nbsp;==&nbsp;bytes_read)&nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp;//&nbsp;read&nbsp;EOF&lt;/div&gt;&lt;div&gt; &nbsp;parser_parse(&amp;parser,&nbsp;(char[]){0},&nbsp;1);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;the&nbsp;downside&nbsp;is&nbsp;that&nbsp;adding&nbsp;null&nbsp;terminators&nbsp;to&nbsp;the&nbsp;parser&nbsp;reduces&nbsp;the&nbsp;extensibility&nbsp;of&nbsp;the&nbsp;parser;&nbsp;it&#39;s&nbsp;harder&nbsp;to&nbsp;add&nbsp;the&nbsp;parser&nbsp;as&nbsp;a&nbsp;&quot;sub&nbsp;parser&quot;&nbsp;of&nbsp;another&nbsp;parser.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;EOF&nbsp;actions are&nbsp;run&nbsp;when&nbsp;&#39;p&nbsp;==&nbsp;pe&nbsp;==&nbsp;eof&#39;.&nbsp;These&nbsp;are&nbsp;essentially&nbsp;the&nbsp;same&nbsp;as&nbsp;adding&nbsp;a&nbsp;null&nbsp;terminator&nbsp;to&nbsp;the&nbsp;parser&nbsp;since&nbsp;you&nbsp;need&nbsp;to&nbsp;know&nbsp;in&nbsp;advance&nbsp;that&nbsp;you&#39;ve&nbsp;hit&nbsp;the&nbsp;EOF&nbsp;-&nbsp;but&nbsp;you&nbsp;move&nbsp;the&nbsp;action&nbsp;from&nbsp;a&nbsp;final&nbsp;state&nbsp;transition&nbsp;to&nbsp;an&nbsp;EOF&nbsp;action.&nbsp;I&#39;ve&nbsp;not&nbsp;really&nbsp;used&nbsp;eof&nbsp;actions&nbsp;that&nbsp;much&nbsp;because&nbsp;I&nbsp;find&nbsp;them&nbsp;slightly&nbsp;wierd&nbsp;to&nbsp;use,&nbsp;but&nbsp;someone&nbsp;can&nbsp;fill&nbsp;in&nbsp;on&nbsp;the&nbsp;details.&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Sat,&nbsp;Feb&nbsp;29,&nbsp;2020&nbsp;at&nbsp;1:05&nbsp;AM&nbsp;Iñaki&nbsp;Baz&nbsp;Castillo&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:ibc@aliax.net&quot;&gt;ibc@aliax.net&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
After&nbsp;many&nbsp;years&nbsp;using&nbsp;my&nbsp;Ragel&nbsp;based&nbsp;IPv6&nbsp;parser,&nbsp;I&#39;ve&nbsp;found&nbsp;a&nbsp;bug.&nbsp;I&lt;br&gt;<br>
think&nbsp;I&#39;ve&nbsp;also&nbsp;understood&nbsp;the&nbsp;problem&nbsp;and&nbsp;simplified&nbsp;the&nbsp;code&nbsp;as&nbsp;much&lt;br&gt;<br>
as&nbsp;possible.&lt;br&gt;<br>
&lt;br&gt;<br>
Let&#39;s&nbsp;assume&nbsp;this&nbsp;simple&nbsp;grammar:&lt;br&gt;<br>
&lt;br&gt;<br>
--------------------&lt;br&gt;<br>
foo&nbsp;=&nbsp;&quot;12345&quot;&nbsp;|&nbsp;&quot;123&quot;;&lt;br&gt;<br>
-------------------&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;parser.rl&nbsp;has&nbsp;a&nbsp;function&nbsp;that&nbsp;receives&nbsp;a&nbsp;char*&nbsp;data&nbsp;pointer&nbsp;and&nbsp;a&lt;br&gt;<br>
size_t&nbsp;len.&nbsp;It&nbsp;includes&nbsp;the&nbsp;Ragel&nbsp;%%&nbsp;lines&nbsp;as&nbsp;usual.&nbsp;At&nbsp;the&nbsp;end&nbsp;of&nbsp;the&lt;br&gt;<br>
function&nbsp;it&nbsp;checks:&lt;br&gt;<br>
&lt;br&gt;<br>
--------------------&lt;br&gt;<br>
//&nbsp;Ensure&nbsp;that&nbsp;the&nbsp;parsing&nbsp;has&nbsp;consumed&nbsp;all&nbsp;the&nbsp;given&nbsp;length.&lt;br&gt;<br>
if&nbsp;(len&nbsp;==&nbsp;p&nbsp;-&nbsp;data)&lt;br&gt;<br>
 &nbsp;return&nbsp;true;&lt;br&gt;<br>
else&lt;br&gt;<br>
 &nbsp;return&nbsp;false;&lt;br&gt;<br>
--------------------&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;problem&nbsp;is&nbsp;that,&nbsp;when&nbsp;the&nbsp;input&nbsp;is&nbsp;&quot;1234&quot;,&nbsp;the&nbsp;parser&nbsp;returns&nbsp;true.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;think&nbsp;I&nbsp;understand&nbsp;the&nbsp;problem:&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;The&nbsp;parser&nbsp;first&nbsp;matches&nbsp;&quot;123&quot;&nbsp;which&nbsp;is&nbsp;valid.&lt;br&gt;<br>
-&nbsp;It&nbsp;continues&nbsp;and&nbsp;matches&nbsp;&quot;1234&quot;.&lt;br&gt;<br>
-&nbsp;At&nbsp;this&nbsp;time&nbsp;it&nbsp;has&nbsp;consumed&nbsp;4&nbsp;chars.&lt;br&gt;<br>
-&nbsp;It&nbsp;exits&nbsp;now&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;more&nbsp;chars&nbsp;in&nbsp;the&nbsp;input.&lt;br&gt;<br>
-&nbsp;However&nbsp;it&nbsp;did&nbsp;match&nbsp;&quot;123&quot;&nbsp;so&nbsp;the&nbsp;Ragel&nbsp;action&nbsp;was&nbsp;executed.&lt;br&gt;<br>
&lt;br&gt;<br>
May&nbsp;I&nbsp;know&nbsp;how&nbsp;to&nbsp;avoid&nbsp;this&nbsp;problem&nbsp;and&nbsp;make&nbsp;the&nbsp;parser&nbsp;function&lt;br&gt;<br>
return&nbsp;false&nbsp;in&nbsp;this&nbsp;case?&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks&nbsp;a&nbsp;lot.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
--&nbsp;&lt;br&gt;<br>
Iñaki&nbsp;Baz&nbsp;Castillo&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;mailto:ibc@aliax.net&quot;&nbsp;target=&quot;_blank&quot;&gt;ibc@aliax.net&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
ragel-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:ragel-users@colm.net&quot;&nbsp;target=&quot;_blank&quot;&gt;ragel-users@colm.net&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://www.colm.net/cgi-bin/mailman/listinfo/ragel-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.colm.net/cgi-bin/mailman/listinfo/ragel-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
